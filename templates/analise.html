<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alien Roulette - Análise Preditiva</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <nav>
            <div class="logo">
                <a href="{{ url_for('home') }}">Alien<span>Team.</span></a>
            </div>
            <ul>
                <li><a href="{{ url_for('logout') }}" class="logout-button">Sair</a></li>
            </ul>
        </nav>

        <!-- ÁREA INTERATIVA COM A TABELA E A PISTA -->
        <div class="interactive-area">
            <div id="roulette-table-svg-container">
                <!-- SVG da Tabela Profissional -->
                <svg viewBox="0 0 412.90625 100.90625" text-rendering="geometricPrecision"><g class="classicStandard-wrapper"><polygon class="green_shape" data-bet-spot-id="0" points="0.25,31.627 6.919,0.25 28.558,0.25 28.558,63.004 6.919,63.004"></polygon><rect class="red_num_shape" data-bet-spot-id="3" x="28.6" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="2" x="28.6" y="21.2" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="1" x="28.6" y="42.1" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="6" x="58.4" y="0.3" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="5" x="58.4" y="21.2" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="4" x="58.4" y="42.1" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="9" x="88.2" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="8" x="88.2" y="21.2" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="7" x="88.2" y="42.1" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="12" x="118" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="11" x="118" y="21.2" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="10" x="118" y="42.1" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="15" x="147.8" y="0.3" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="14" x="147.8" y="21.2" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="13" x="147.8" y="42.1" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="18" x="177.5" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="17" x="177.5" y="21.2" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="16" x="177.5" y="42.1" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="21" x="207.3" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="20" x="207.3" y="21.2" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="19" x="207.3" y="42.1" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="24" x="237.1" y="0.3" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="23" x="237.1" y="21.2" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="22" x="237.1" y="42.1" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="27" x="266.9" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="26" x="266.9" y="21.2" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="25" x="266.9" y="42.1" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="30" x="296.7" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="29" x="296.7" y="21.2" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="28" x="296.7" y="42.1" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="33" x="326.5" y="0.3" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="32" x="326.5" y="21.2" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="31" x="326.5" y="42.1" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="36" x="356.3" y="0.3" width="29.798" height="20.918"></rect><rect class="black_num_shape" data-bet-spot-id="35" x="356.3" y="21.2" width="29.798" height="20.918"></rect><rect class="red_num_shape" data-bet-spot-id="34" x="356.3" y="42.1" width="29.798" height="20.918"></rect><text class="green_shape_label vertical_center" x="3.5%" y="31.3%">0</text><text class="red_num_shape_label vertical_center" x="10.5%" y="52.1%">1</text><text class="black_num_shape_label vertical_center" x="10.5%" y="31.4%">2</text><text class="red_num_shape_label vertical_center" x="10.5%" y="10.7%">3</text><text class="black_num_shape_label vertical_center" x="17.8%" y="52.1%">4</text><text class="red_num_shape_label vertical_center" x="17.8%" y="31.4%">5</text><text class="black_num_shape_label vertical_center" x="17.8%" y="10.7%">6</text><text class="red_num_shape_label vertical_center" x="25.0%" y="52.1%">7</text><text class="black_num_shape_label vertical_center" x="25.0%" y="31.4%">8</text><text class="red_num_shape_label vertical_center" x="25.0%" y="10.7%">9</text><text class="black_num_shape_label vertical_center" x="32.2%" y="52.1%">10</text><text class="black_num_shape_label vertical_center" x="32.2%" y="31.4%">11</text><text class="red_num_shape_label vertical_center" x="32.2%" y="10.7%">12</text><text class="black_num_shape_label vertical_center" x="39.4%" y="52.1%">13</text><text class="red_num_shape_label vertical_center" x="39.4%" y="31.4%">14</text><text class="black_num_shape_label vertical_center" x="39.4%" y="10.7%">15</text><text class="red_num_shape_label vertical_center" x="46.6%" y="52.1%">16</text><text class="black_num_shape_label vertical_center" x="46.6%" y="31.4%">17</text><text class="red_num_shape_label vertical_center" x="46.6%" y="10.7%">18</text><text class="red_num_shape_label vertical_center" x="53.8%" y="52.1%">19</text><text class="black_num_shape_label vertical_center" x="53.8%" y="31.4%">20</text><text class="red_num_shape_label vertical_center" x="53.8%" y="10.7%">21</text><text class="black_num_shape_label vertical_center" x="61.0%" y="52.1%">22</text><text class="red_num_shape_label vertical_center" x="61.0%" y="31.4%">23</text><text class="black_num_shape_label vertical_center" x="61.0%" y="10.7%">24</text><text class="red_num_shape_label vertical_center" x="68.2%" y="52.1%">25</text><text class="black_num_shape_label vertical_center" x="68.2%" y="31.4%">26</text><text class="red_num_shape_label vertical_center" x="68.2%" y="10.7%">27</text><text class="black_num_shape_label vertical_center" x="75.5%" y="52.1%">28</text><text class="black_num_shape_label vertical_center" x="75.5%" y="31.4%">29</text><text class="red_num_shape_label vertical_center" x="75.5%" y="10.7%">30</text><text class="black_num_shape_label vertical_center" x="82.7%" y="52.1%">31</text><text class="red_num_shape_label vertical_center" x="82.7%" y="31.4%">32</text><text class="black_num_shape_label vertical_center" x="82.7%" y="10.7%">33</text><text class="red_num_shape_label vertical_center" x="89.9%" y="52.1%">34</text><text class="black_num_shape_label vertical_center" x="89.9%" y="31.4%">35</text><text class="red_num_shape_label vertical_center" x="89.9%" y="10.7%">36</text></g></svg>
            </div>
            <div id="racetrack-container">
                <!-- SVG da Pista -->
                <svg viewBox="0 0 190.515625 50.453125" text-rendering="geometricPrecision"><g class="classicRacetrackWrapper"><path class="green_shape" data-bet-spot-id="0" d="M 178.783 46.007 A 24.777 24.777 0 0 0 188.716 33.294 L 176.719 29.163 A 12.089 12.089 0 0 1 171.873 35.366 Z"></path><rect class="red_num_shape" data-bet-spot-id="1" x="48.482" y="0.45" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="2" x="110.852" y="37.315" width="10.395" height="12.688"></rect><path class="red_num_shape" data-bet-spot-id="3" d="M 178.783 4.447 A 24.777 24.777 0 0 1 188.716 17.16 L 176.719 21.291 A 12.089 12.089 0 0 0 171.873 15.088 Z"></path><rect class="black_num_shape" data-bet-spot-id="4" x="131.642" y="37.315" width="10.395" height="12.688"></rect><path class="red_num_shape" data-bet-spot-id="5" d="M 14.365 2.958 A 24.777 24.777 0 0 0 4.215 12.097 L 14.975 18.821 A 12.089 12.089 0 0 1 19.928 14.361 Z"></path><rect class="black_num_shape" data-bet-spot-id="6" x="69.272" y="37.315" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="7" x="131.642" y="0.45" width="10.395" height="12.688"></rect><path class="black_num_shape" data-bet-spot-id="8" d="M 14.365 47.496 A 24.777 24.777 0 0 1 4.215 38.357 L 14.975 31.633 A 12.089 12.089 0 0 0 19.928 36.093 Z"></path><rect class="red_num_shape" data-bet-spot-id="9" x="90.062" y="0.45" width="10.395" height="12.688"></rect><path class="black_num_shape" data-bet-spot-id="10" d="M 0.45 25.227 A 24.777 24.777 0 0 1 4.215 12.097 L 14.975 18.821 A 12.089 12.089 0 0 0 13.138 25.227 Z"></path><rect class="black_num_shape" data-bet-spot-id="11" x="27.692" y="37.315" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="12" x="152.432" y="0.45" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="13" x="48.482" y="37.315" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="14" x="69.272" y="0.45" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="15" x="152.432" y="37.315" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="16" x="27.692" y="0.45" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="17" x="90.062" y="37.315" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="18" x="110.852" y="0.45" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="19" x="142.037" y="37.315" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="20" x="58.877" y="0.45" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="21" x="121.247" y="37.315" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="22" x="100.457" y="0.45" width="10.395" height="12.688"></rect><path class="red_num_shape" data-bet-spot-id="23" d="M 4.215 38.357 A 24.777 24.777 0 0 1 0.45 25.227 L 13.138 25.227 A 12.089 12.089 0 0 0 14.975 31.633 Z"></path><path class="black_num_shape" data-bet-spot-id="24" d="M 25.227 13.138 L 27.692 13.138 L 27.692 0.45 L 25.227 0.45 L 25.227 0.45 A 24.777 24.777 0 0 0 14.365 2.958 L 19.928 14.361 A 12.089 12.089 0 0 1 25.227 13.138 Z"></path><rect class="red_num_shape" data-bet-spot-id="25" x="100.457" y="37.315" width="10.395" height="12.688"></rect><path class="black_num_shape" data-bet-spot-id="26" d="M 188.716 17.16 A 24.777 24.777 0 0 1 188.716 33.294 L 176.719 29.163 A 12.089 12.089 0 0 0 176.719 21.291 Z"></path><rect class="red_num_shape" data-bet-spot-id="27" x="58.877" y="37.315" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="28" x="142.037" y="0.45" width="10.395" height="12.688"></rect><rect class="black_num_shape" data-bet-spot-id="29" x="121.247" y="0.45" width="10.395" height="12.688"></rect><path class="red_num_shape" data-bet-spot-id="30" d="M 25.227 37.315 L 27.692 37.315 L 27.692 50.003 L 25.227 50.003 L 25.227 50.004 A 24.777 24.777 0 0 1 14.365 47.496 L 19.928 36.093 A 12.089 12.089 0 0 0 25.227 37.316 Z"></path><rect class="black_num_shape" data-bet-spot-id="31" x="79.667" y="0.45" width="10.395" height="12.688"></rect><path class="red_num_shape" data-bet-spot-id="32" d="M 165.289 37.315 L 162.824 37.315 L 162.824 50.003 L 165.289 50.003 L 165.289 50.004 A 24.777 24.777 0 0 0 178.783 46.007 L 171.873 35.366 A 12.089 12.089 0 0 1 165.289 37.316 Z"></path><rect class="black_num_shape" data-bet-spot-id="33" x="38.087" y="0.45" width="10.395" height="12.688"></rect><rect class="red_num_shape" data-bet-spot-id="34" x="79.667" y="37.315" width="10.395" height="12.688"></rect><path class="black_num_shape" data-bet-spot-id="35" d="M 165.289 13.138 L 162.824 13.138 L 162.824 0.45 L 165.289 0.45 L 165.289 0.45 A 24.777 24.777 0 0 1 178.783 4.447 L 171.873 15.088 A 12.089 12.089 0 0 0 165.289 13.138 Z"></path><rect class="red_num_shape" data-bet-spot-id="36" x="38.087" y="37.315" width="10.395" height="12.688"></rect><text class="green_shape_label vertical_center" x="94.4%" y="72.5%">0</text><text class="red_num_shape_label vertical_center" x="28.2%" y="13.5%">1</text><text class="black_num_shape_label vertical_center" x="60.9%" y="86.5%">2</text><text class="red_num_shape_label vertical_center" x="94.4%" y="27.5%">3</text><text class="black_num_shape_label vertical_center" x="71.8%" y="86.5%">4</text><text class="red_num_shape_label vertical_center" x="6.8%" y="22.9%">5</text><text class="black_num_shape_label vertical_center" x="39.1%" y="86.5%">6</text><text class="red_num_shape_label vertical_center" x="71.8%" y="13.5%">7</text><text class="black_num_shape_label vertical_center" x="6.8%" y="77.2%">8</text><text class="red_num_shape_label vertical_center" x="50.0%" y="13.5%">9</text><text class="black_num_shape_label vertical_center" x="3.9%" y="39.9%">10</text><text class="black_num_shape_label vertical_center" x="17.3%" y="86.5%">11</text><text class="red_num_shape_label vertical_center" x="82.7%" y="13.5%">12</text><text class="black_num_shape_label vertical_center" x="28.2%" y="86.5%">13</text><text class="red_num_shape_label vertical_center" x="39.1%" y="13.5%">14</text><text class="black_num_shape_label vertical_center" x="82.7%" y="86.5%">15</text><text class="red_num_shape_label vertical_center" x="17.3%" y="13.5%">16</text><text class="black_num_shape_label vertical_center" x="50.0%" y="86.5%">17</text><text class="red_num_shape_label vertical_center" x="60.9%" y="13.5%">18</text><text class="red_num_shape_label vertical_center" x="77.3%" y="86.5%">19</text><text class="black_num_shape_label vertical_center" x="33.6%" y="13.5%">20</text><text class="red_num_shape_label vertical_center" x="66.4%" y="86.5%">21</text><text class="black_num_shape_label vertical_center" x="55.5%" y="13.5%">22</text><text class="red_num_shape_label vertical_center" x="3.9%" y="60.1%">23</text><text class="black_num_shape_label vertical_center" x="11.7%" y="14.4%">24</text><text class="red_num_shape_label vertical_center" x="55.5%" y="86.5%">25</text><text class="black_num_shape_label vertical_center" x="96.4%" y="50.0%">26</text><text class="red_num_shape_label vertical_center" x="33.6%" y="86.5%">27</text><text class="black_num_shape_label vertical_center" x="77.3%" y="13.5%">28</text><text class="black_num_shape_label vertical_center" x="66.4%" y="13.5%">29</text><text class="red_num_shape_label vertical_center" x="11.7%" y="85.6%">30</text><text class="black_num_shape_label vertical_center" x="44.5%" y="13.5%">31</text><text class="red_num_shape_label vertical_center" x="88.9%" y="85.0%">32</text><text class="black_num_shape_label vertical_center" x="22.7%" y="13.5%">33</text><text class="red_num_shape_label vertical_center" x="44.5%" y="86.5%">34</text><text class="black_num_shape_label vertical_center" x="88.9%" y="15.0%">35</text><text class="red_num_shape_label vertical_center" x="22.7%" y="86.5%">36</text></g></svg>
            </div>
        </div>

        <div class="analysis-panel">
            <div class="panel-section">
                <h1>ANÁLISE PREDITIVA ATIVADA.</h1>
                <p>Nossa IA analisa a confluência de tendências para encontrar o alvo único de maior probabilidade.</p>
                <div class="input-row">
                    <input type="text" id="numeros-input" placeholder="Clique nos números ou digite aqui..." autocomplete="off">
                </div>
                <div class="actions-row">
                    <button id="limpar-btn" class="action-btn">Limpar Histórico</button>
                    <button id="desfazer-btn" class="action-btn-secondary">Desfazer</button>
                </div>
            </div>

            <div class="panel-section">
                <h2>Histórico Atual (Últimos 13):</h2>
                <p id="historico">Nenhum número adicionado.</p>
            </div>
            
            <div id="results-wrapper" style="display: none;">
                <div class="panel-section">
                    <h2 id="veredito" style="font-size: 24px; font-weight: bold; color: var(--color-primary);"></h2>
                    <p id="confianca" style="margin-top: 5px; color: #ccc;"></p>
                </div>

                <div class="panel-section results-section">
                    <div class="result-item">
                        <h2>Alvo Principal:</h2>
                        <p id="alvo-principal"></p>
                    </div>
                    <div class="result-item full-width">
                        <h2>Todos Alvos Confirmados (do mais forte ao mais fraco):</h2>
                        <div id="alvos-detalhados"></div>
                    </div>
                </div>
            </div>

            <div class="panel-section" id="waiting-container">
                 <h2 id="waiting-title">Aguardando Análise...</h2>
                 <p id="waiting-text">Insira 13 números para iniciar a análise avançada.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('numeros-input');
            const historicoEl = document.getElementById('historico');
            const alvosDetalhadosEl = document.getElementById('alvos-detalhados');
            const alvoPrincipalEl = document.getElementById('alvo-principal');
            const vereditoEl = document.getElementById('veredito');
            const confiancaEl = document.getElementById('confianca');
            const resultsWrapper = document.getElementById('results-wrapper');
            const waitingContainer = document.getElementById('waiting-container');
            const waitingTitle = document.getElementById('waiting-title');
            const waitingText = document.getElementById('waiting-text');
            const limparBtn = document.getElementById('limpar-btn');
            const desfazerBtn = document.getElementById('desfazer-btn');
    
            const handleInput = async () => {
                const numerosParaEnviar = input.value.trim().split(/[\s,]+/).filter(Boolean).join(',');

                const response = await fetch('/update_analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ numeros: numerosParaEnviar }),
                });
                const data = await response.json();
                
                historicoEl.textContent = data.historico_str.replace(/,/g, ' ');
                document.querySelectorAll('[data-bet-spot-id].highlighted').forEach(el => el.classList.remove('highlighted'));
    
                if (!data.show_results) {
                    resultsWrapper.style.display = 'none';
                    waitingContainer.style.display = 'block';
                    waitingTitle.textContent = data.veredito;
                    waitingText.textContent = data.confianca;
                } else {
                    waitingContainer.style.display = 'none';
                    resultsWrapper.style.display = 'block';
                    
                    vereditoEl.innerHTML = data.veredito; 
                    confiancaEl.textContent = data.confianca;
                    alvoPrincipalEl.textContent = data.alvo_principal;
                    
                    alvosDetalhadosEl.innerHTML = '';
                    if (data.alvos_detalhados && data.alvos_detalhados.length > 0) {
                        data.alvos_detalhados.forEach(item => {
                            const p = document.createElement('p');
                            p.innerHTML = item;
                            alvosDetalhadosEl.appendChild(p);
                        });
                    }

                    if (data.numeros_para_destacar && data.numeros_para_destacar.length > 0) {
                        data.numeros_para_destacar.forEach(num => {
                            document.querySelectorAll(`[data-bet-spot-id="${num}"]`).forEach(el => {
                                el.classList.add('highlighted');
                            });
                        });
                    }
                }
            };
    
            limparBtn.addEventListener('click', () => { input.value = ''; handleInput(); });
            desfazerBtn.addEventListener('click', () => {
                let nums = input.value.trim().split(/[\s,]+/).filter(Boolean);
                if (nums.length > 0) { nums.pop(); input.value = nums.join(' '); handleInput(); }
            });
            input.addEventListener('input', handleInput);
    
            document.querySelector('.interactive-area').addEventListener('click', function(e) {
                const target = e.target.closest('[data-bet-spot-id]');
                if (target) {
                    const num = target.dataset.betSpotId;
                    if (isNaN(parseInt(num, 10))) return;
                    let nums = input.value.trim().split(/[\s,]+/).filter(Boolean);
                    
                    if (nums.length < 13) {
                       nums.push(num);
                       input.value = nums.join(' ');
                       handleInput();
                    } else {
                        console.log("Limite de 13 números atingido.");
                    }
                }
            });
            handleInput(); 
        });
    </script>
</body>
</html>